---
name: Add Film
on:
    workflow_dispatch:
        inputs:
            Title:
                description: "Title"
                required: true
            Rating:
                description: "Rating"
                required: true
env:
    actor: ${{ github.actor }}
    owner: ${{ github.repository_owner }}
    github_token: ${{ secrets.GITHUB_TOKEN }}
jobs:
    Build:
        if: ${{ github.actor == github.repository_owner }}
        runs-on: macOS-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                  python-version: 3.13.1
            - uses: actions/cache@v4
              name: Configure pip caching
              with:
                  path: ~/.cache/pip
                  key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
                  restore-keys: |
                      ${{ runner.os }}-pip-
            - name: Install Python dependencies
              run: |
                  python -m pip install -r "./_python/requirements.txt" --quiet
            - name: Run add_film script
              run: |
                  python '_python/add_film.py' --title "${{ inputs.Title }}" --rating "${{ inputs.Rating }}"
            - name: Commit files
              run: |
                  git config --local user.email "action@github.com"
                  git config --local user.name "GitHub Action"
                  git add -A
                  git commit -m "Added ${{ inputs.Title }}" || echo "No changes to commit"
                  git push
